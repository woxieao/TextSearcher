@{
    ViewBag.Title = "添加非备案商品";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using Giqci.PublicWeb.Extensions
@using Newtonsoft.Json
@section Footer{
    <script type="text/javascript">

        app.controller("AddCustomProductController", [
            '$http', '$scope', '$location', '$log', 'alertService', function ($http, $scope, $location, $log, alertService) {
                $scope.model = ObjDecodeToJson(@HtmlExtensions.RawJson(Model));
                $scope.flag = null;
                $scope.alreadySubmit = false;
                $(function () {
                    $('.datetimepicker').datetimepicker({
                        language: 'zh-CN',
                        format: 'yyyy/mm/dd',
                        autoclose: true,
                        minView: "month",
                        todayBtn: true,
                    }).on("hide", function () {
                        var $this = $(this);
                        var _this = this;
                        $scope.$apply(function () {
                            $scope[$this.attr('ng-model')] = _this.value;
                        });
                    });
                    if ($scope.model.Id > 0) {
                        $(".panel-title").html("编辑商品<span class=\"small pull-right\"><span class=\"glyphicon glyphicon-arrow-left\" aria-hidden=\"true\"></span>&nbsp;<a href=\"/goods/list\">返回列表</a></span>");
                    }
                });
                $scope.loadCountriesDict = null;
                $scope.loadCountries = function () {
                    $giqci.get("/api/dict/countries", { 'code': "" }).success(function (data) {
                        $scope.loadCountriesDict = data.items;
                    }, $scope);
                };
                $scope.model.ManufacturerCountry = '036';
                $scope.loadCountries();

                $scope.submitForm = function (isValid) {
                    if (isValid) {
                        $scope.alreadySubmit = true;
                        $giqci.post('/api/goods/addcustomproduct', $scope.model).success(function (response) {
                            $scope.flag = response.flag;
                            $scope.alreadySubmit = false;
                            if ($scope.flag) {
                                layer.msg(response.msg, { icon: 6 });
                                $scope.model = { ManufacturerCountry: "036" };
                                $("#commonhscodes").next().find("span.select2-selection__rendered").html("");
                                $("#ManufacturerCountry").next().find("span.select2-selection__rendered").html("");
                            } else {
                                layer.alert(response.msg, function (index) {
                                    layer.close(index);
                                });
                              }
                        }, $scope);
                    } else {
                        $scope.alreadySubmit = false;
                    }
                };
            }
        ]);
    </script>
}
<div ng-controller="AddCustomProductController">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">
                添加非备案商品
                <span class="pull-right">
                    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>&nbsp;<a href="/goods/list">返回列表</a>
                </span>
            </h3>
        </div>
        <div class="panel-body">
            <form name="appform" class="form-horizontal" method="POST" ng-submit="submitForm(appform.$valid)" novalidate>
                <div class="form-group">
                    <label class="col-sm-2 control-label">自定义标识<span>&nbsp;&nbsp;</span></label>
                    <div class="col-sm-8">
                        <input type="text" ng-model="model.Code" maxlength="50" class="form-control" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">名称(英文)<span class="input-require-color">&nbsp;&lowast;</span></label>
                    <div class="col-sm-8">
                        <input type="text" ng-model="model.DescriptionEn" class="form-control"
                               ucc-require="名称不能为空"  submit-btn-id="showProduct" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">名称(中文)<span class="input-require-color">&nbsp;&lowast;</span></label>
                    <div class="col-sm-8">
                        <input type="text" ng-model="model.Description" class="form-control"
                               ucc-require="名称不能为空"  submit-btn-id="showProduct" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">品牌<span class="input-require-color">&nbsp;&lowast;</span></label>
                    <div class="col-sm-8">
                        <input type="text" ng-model="model.Brand" class="form-control" 
                               ucc-require="品牌不能为空"  submit-btn-id="showProduct"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">HS编码<span class="input-require-color">&nbsp;&lowast;</span></label>
                    <div class="col-sm-8">
                        <select id="commonhscodes" ajax-select ajax-url="commonhscodes" 
                                ng-model="model.HsCode" class="form-control">
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">包装<span class="input-require-color">&nbsp;&lowast;</span></label>
                    <div class="col-sm-8">
                        <select ng-model="model.Package" class="form-control half-form-control"
                                ucc-require="请选择包装类型"  submit-btn-id="showProduct">
                            <option value="罐装">罐装</option>
                            <option value="瓶装">瓶装</option>
                            <option value="袋装">袋装</option>
                            <option value="盒装">盒装</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">规格<span class="input-require-color">&nbsp;&lowast;</span></label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" ng-model="model.Spec"
                               ucc-require="规格不能为空"  submit-btn-id="showProduct" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">制造商<span class="input-require-color">&nbsp;&lowast;</span></label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" ng-model="model.Manufacturer" 
                               ucc-require="制造商不能为空"  submit-btn-id="showProduct"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">原产国<span class="input-require-color">&nbsp;&lowast;</span></label>
                    <div class="col-sm-8">
                        <select ajax-country ajax-url="countries" id="ManufacturerCountry" 
                                ng-model="model.ManufacturerCountry" class="form-control" style="width: 100%">
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button class="btn btn-default" id="showProduct" type="submit" ng-disabled="alreadySubmit">
                            <span class="glyphicon glyphicon-ok-circle" aria-hidden="true"></span> 提交
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>