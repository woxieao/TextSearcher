@using Giqci.Chapi.Enums.App
@using Giqci.Chapi.Models.App
@using Giqci.PublicWeb.Extensions
@using Giqci.PublicWeb.Models
@using Giqci.Tools
@using Ktech.Extensions
@using Newtonsoft.Json
@model Giqci.Chapi.Models.App.Application
<div class="row" ng-controller="ViewAppController">
    <div class="col-md-12" id="print">
        <h1>@("view".KeyToWord()) - {{model.Application.Key}}</h1>
        <div class="form-horizontal">
            <div class="form-horizontal">
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("application_number".KeyToWord())</label>
                    <span class="col-sm-2 form-control-static">{{model.Application.Key}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("certificate_category".KeyToWord())</label>
                    <p class="form-control-static col-sm-10">
                        <span ng-if="model.Application.C101">@("c101_cert".KeyToWord())</span>
                        <span ng-if="model.Application.C102">@("c102_cert".KeyToWord())</span>
                        <span ng-if="model.Application.C103">@("c103_cert".KeyToWord())</span>
                    </p>
                </div>
                <div class="form-group" ng-if="false">
                    <label class="col-sm-2 control-label">@("sample_list".KeyToWord())</label>
                    <div class="col-sm-10">
                        <div ng-repeat="item in model.Application.ExampleCertList">
                            <table class="table table-striped">
                                <colgroup>
                                    <col width="100" />
                                    <col width="100" />
                                </colgroup>
                                <tr>
                                    <th>@("sample".KeyToWord()){{$index+1}}</th>
                                    <td>
                                        <a href="@LanCore.GetLanTypeUrl("/file/viewfile")?fileFullPath={{item.CertFilePath}}" target="_blank">@("view_file".KeyToWord())</a>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("business_purpose".KeyToWord())</label>
                    <span class="col-sm-2 form-control-static">{{model.Application.TradeType == 4?"一般贸易":"电商贸易" |trade_type_language}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("create_date".KeyToWord())</label>
                    <span class="col-sm-2 form-control-static">{{model.Application.CreateDate | date:'yyyy/MM/dd'}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("status".KeyToWord())</label>
                    <span class="col-sm-2 form-control-static">{{StatusDescription | application_status_language}}</span>
                </div>
                <div class="form-group" ng-if="model.Application.DeclineReason">
                    <label class="col-sm-2 control-label">@("reason_for_rejection".KeyToWord())</label>
                    <span class="col-sm-2 form-control-static">{{model.Application.DeclineReason}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("applicant".KeyToWord())</label>
                    <div class="col-sm-8">
                        <p class="form-control-static">@("full_name".KeyToWord()): {{model.Application.Applicant}}</p>
                        <p class="form-control-static">@("address".KeyToWord()): {{model.Application.ApplicantAddr}}</p>
                        <p class="form-control-static">@("contacts".KeyToWord()): {{model.Application.ApplicantContact}}</p>
                        <p class="form-control-static">@("contact_number".KeyToWord()): {{model.Application.ApplicantPhone}}</p>
                        <p class="form-control-static">@("email".KeyToWord()):{{model.Application.ApplicantEmail}}</p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("exporter".KeyToWord())</label>
                    <div class="col-sm-8">
                        <p class="form-control-static">@("full_name".KeyToWord()): {{model.Application.Exporter}}</p>
                        <p class="form-control-static">@("address".KeyToWord()): {{model.Application.ExporterAddr}}</p>
                        <p class="form-control-static">@("contacts".KeyToWord()): {{model.Application.ExporterContact}}</p>
                        <p class="form-control-static">@("contact_number".KeyToWord()): {{model.Application.ExporterPhone}}</p>
                    </div>
                </div>
                <div class="form-group">
                    <label ng-if="model.Application.TradeType==4" class="col-sm-2 control-label">@("importer".KeyToWord())</label>
                    <label ng-if="model.Application.TradeType==1" class="col-sm-2 control-label">@("agent_importer".KeyToWord())</label>
                    <div class="col-sm-8">
                        <p class="form-control-static">@("full_name".KeyToWord()):{{model.Application.Importer}}</p>
                        <p class="form-control-static">@("address".KeyToWord()): {{model.Application.ImporterAddr}}</p>
                        <p class="form-control-static">@("contacts".KeyToWord()): {{model.Application.ImporterContact}}</p>
                        <p class="form-control-static">@("contact_number".KeyToWord()): {{model.Application.ImporterPhone}}</p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("commodity_information".KeyToWord())</label>
                    <div class="col-sm-8">
                        <div ng-repeat="item in model.Application.ApplicationProducts" class="application-product-area">
                            <table class="table table-hover application-table-margin">
                                <colgroup>
                                    <col width="150">
                                    <col width="235">
                                    <col width="150">
                                    <col width="235">
                                </colgroup>
                                <tr class="application-table-head">
                                    <th>
                                        <p class="form-control-static">@("goods".KeyToWord()) {{$index+1}}</p>
                                    </th>
                                    <td></td>
                                    <th></th>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">@("common_goods".KeyToWord())</p>
                                    </th>
                                    <td colspan="3">
                                        <p class="form-control-static">{{item.CiqCode?item.CiqCode:item.ProductKey}}</p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">@("name".KeyToWord())(@("english".KeyToWord()))</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static">{{item.DescriptionEn}}</p>
                                    </td>
                                    <th>
                                        <p class="form-control-static">@("name".KeyToWord())(@("chinese".KeyToWord()))</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static">{{item.Description}}</p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">@("brand".KeyToWord())</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static">{{item.Brand}}</p>
                                    </td>
                                    <th>
                                        <p class="form-control-static">@("package".KeyToWord())</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static">{{item.Package}}</p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">@("spec".KeyToWord())</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static">{{item.Spec}}</p>
                                    </td>
                                    <th>
                                        <p class="form-control-static">@("country_of_origin".KeyToWord())</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static" ajax-label ajax-url="countries" ng-model="item.ManufacturerCountry">{{item.ManufacturerCountry}}</p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">@("hs_code".KeyToWord())</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static" ng-model="item.HSCode">{{item.HSCode}}</p>
                                    </td>
                                    <th>
                                        <p class="form-control-static">@("manufacturer".KeyToWord())</p>
                                    </th>
                                    <td>
                                        <p ng-model="item.Manufacturer" class="form-control-static">{{item.Manufacturer}}</p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">@("quantity".KeyToWord())</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static" ng-model="item.Quantity">{{item.Quantity}}</p>
                                    </td>
                                    <th></th>
                                    <td></td>
                                </tr>
                                <tr ng-if="model.Application.C102">
                                    <th>
                                        <p class="form-control-static">@("quality_restriction".KeyToWord())</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static">{{item.C102?'是':'否' | TorF_language}}</p>
                                    </td>
                                    <th>
                                        <p class="form-control-static" ng-if="item.C102">@("test_item".KeyToWord())</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static" ng-if="item.C102">{{item.C102Comment}}</p>
                                    </td>
                                </tr>
                            </table>
                            <!--批次-->
                            <div>
                                <table class="table table-hover application-table-margin">
                                    <colgroup>
                                        <col width="150" />
                                        <col width="620" />
                                    </colgroup>
                                    <tr ng-repeat="batch in item.ProductItemList">
                                        <th>
                                            <p class="form-control-static">@("batch_number_or_shelf_life".KeyToWord())</p>
                                        </th>
                                        <td>
                                            <p class="form-control-static">{{batch.BatchNo}}</p>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <!--end批次-->
                            <!--真知码-->
                            <table class="table table-hover ">
                                <colgroup>
                                    <col width="150" />
                                    <col width="310" />
                                    <col width="310" />
                                </colgroup>
                                <tr>
                                    <th><p class="form-control-static">@("zcode".KeyToWord())</p></th>
                                    <th><p class="form-control-static">@("head_code".KeyToWord())</p></th>
                                    <th><p class="form-control-static">@("tail_code".KeyToWord())</p></th>
                                </tr>
                                <tr ng-repeat="zcode in item.ApplicationZCodes">
                                    <td>
                                        <p class="form-control-static">@("zcode".KeyToWord()){{$index+1}}</p>
                                    </td>
                                    <td>
                                        <p class="form-control-static">{{zcode.ZCodeStart}}</p>
                                    </td>
                                    <td>
                                        <p class="form-control-static">{{zcode.ZCodeEnd}}</p>
                                    </td>
                                </tr>
                            </table>
                            <!--end真知码-->
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("type_of_shipping".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static" ng-if="model.Application.ShippingMethod==1">@("air_transport".KeyToWord())</span>
                    <span class="col-sm-8 form-control-static" ng-if="model.Application.ShippingMethod==2">@("ocean_shipping".KeyToWord())</span>
                    <span class="col-sm-8 form-control-static" ng-if="model.Application.ShippingMethod==3">@("land_transportation".KeyToWord())</span>
                </div>
                <div class="form-group" ng-show="model.Application.ShippingMethod === 2">
                    <label class="col-sm-2 control-label">@("ship_information".KeyToWord())</label>
                    <div class="col-sm-8">
                        <div ng-repeat="item in model.Application.ContainerInfos">
                            <table class="table table-striped">
                                <colgroup>
                                    <col width="100" />
                                    <col width="100" />
                                </colgroup>
                                <tr>
                                    <th>@("packing_information".KeyToWord()){{$index+1}}</th>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th>@("packing_number".KeyToWord())</th>
                                    <td>{{item.ContainerNumber}}</td>
                                </tr>
                                <tr>
                                    <th>@("seal_no".KeyToWord())</th>
                                    <td>{{item.SealNumber}}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("bill_of_lading_no".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.BillNo}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("second_bill_of_lading_no".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.OtherBillNo}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        <p ng-if="model.Application.ShippingMethod == 1">@("flight_number".KeyToWord())</p>
                        <p ng-if="model.Application.ShippingMethod == 2">@("ship_number".KeyToWord())</p>
                        <p ng-if="model.Application.ShippingMethod == 3">@("license_plate_number".KeyToWord())</p>
                    </label>
                    <span class="col-sm-8 form-control-static">{{model.Application.Vesselcn}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("departure_date".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.Voyage}}</span>
                </div>
                <div class="form-group" ng-if="model.Application.ShippingMethod != 2">
                    <label class="col-sm-2 control-label">@("total_transport_volume".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.TotalUnits}}Pallet(s)</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("total_weight_of_transport".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.TotalWeight | currency:"":2}}KG</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("planned_delivery_date".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.ShippingDate | date:'yyyy/MM/dd'}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("date_of_appointment".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.InspectionDate | date:'yyyy/MM/dd'}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("inspection_site".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.InspectionAddr}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("contacts".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.Inspector}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("contact_phone".KeyToWord())</label>
                    <span class="col-sm-8 form-control-static">{{model.Application.InspectorTel}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("port_of_shipment".KeyToWord())</label>
                    <span ajax-label ajax-url="ports" ng-model="model.Application.LoadingPort" class="col-sm-8 form-control-static">{{model.Application.LoadingPort}}</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">@("port_of_destination".KeyToWord())</label>
                    <span ajax-label ajax-url="ports" ng-model="model.Application.DestPort" class="col-sm-8 form-control-static">{{model.Application.DestPort}}</span>
                </div>
                @{
                    var validCerts = (List<Certificate>)ViewBag.ValidCerts;
                    if (validCerts.Any())
                    {
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">@("certificate_list".KeyToWord())</label>
                                <div class="col-sm-10">
                                    @foreach (var item in validCerts)
                                    {
                                        //todo CertType.C101 and c102
                                        if (item.SignedDate >= Config.Common.ShowCertTimeLine)
                                        {
                                            if (item.CertType == CertType.C101)
                                            {
                                                <div class="form-control-static">
                                                    <strong>@item.CertType.ToDescription()</strong>：<a target="_blank" href="@string.Format("{0}/{1}", Config.Common.ViewFileUrl, Filer.EncryptFilePath(Config.Common.CertFileSavePath, item.CertPath.Substring(0, item.CertPath.Length - 4)+".draft.pdf"))">@item.CertNo</a> by @item.SignedBy @item.SignedDate.DateToString()
                                                </div>
                                            }
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
    <div class="form-horizontal" ng-if="IsPrint">
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button class="btn btn-default" onclick="print()">
                    <span class="glyphicon glyphicon-print" aria-hidden="true"></span>@("print".KeyToWord())
                </button>
            </div>
        </div>
    </div>
</div>
@section Footer{
    <script src="http://code.jquery.com/jquery-migrate-1.1.0.js"></script>
    <script src="~/Global/js/jquery.jqprint-0.3.js"></script>
    <script type="text/javascript">
        app.controller('ViewAppController', [
            '$scope', function ($scope) {
                $scope.model = {};
                $scope.model.Application = ObjDecodeToJson(@HtmlExtensions.RawJson(Model));
                console.log($scope.model);
                $scope.StatusDescription = "@Model.Status.ToDescription()";
                $scope.ShippingMethodDescription = "@Model.ShippingMethod.ToDescription()";
                $scope.IsPrint = "@ViewBag.IsPrint" == "True";
            }
        ]);

        function print() {
            $("#print").jqprint();
        }
    </script>
}