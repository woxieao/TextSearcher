@using Giqci.Chapi.Enums.App
@using Giqci.PublicWeb.Extensions
@using Newtonsoft.Json
@model Giqci.Chapi.Models.App.Application
@{
    ViewBag.Title = "证书申请表格";
}
@section Footer{

    <script type="text/javascript">
        //var app = angular.module("giqci", []);
        function getDate(str) {
            return str ? new Date(str) : null;
        }

        app.controller("GlobalController", ['$http', '$scope', '$log', '$location', '$anchorScroll', '$timeout', '$filter', 'alertService', function ($http, $scope, $log, $location, $anchorScroll, $timeout, $filter, alertService) {
            $scope.model = {};
            $scope.model.Application = ObjDecodeToJson(@HtmlExtensions.RawJson(Model));

            $scope.isNewApp = $scope.model.Application.Key == null;

            window.onbeforeunload = function () {
                return "";
            }
            //if ($scope.isNewApp){
            //window.onbeforeunload = function () {
            //    return "您可以点击[暂存]以保存未提交的申请";
            //}
            //}
            //$log.log($scope.model.Application);
            $scope.CustomerSubmitButton = "提交";
            $scope.CustomerenableDisableButton = false;
            $scope.dataInit = function () {
                $scope.model.Application.InspectionDate = $filter('date')($scope.model.Application.InspectionDate, 'yyyy/MM/dd');
                for (var i = 0; i < $scope.model.Application.ApplicationProducts.length; i++) {
                    for (var j = 0; j < $scope.model.Application.ApplicationProducts[i].ProductItemList.length; j++) {
                        $scope.model.Application.ApplicationProducts[i].ProductItemList[j].ManufacturerDate = $filter('date')($scope.model.Application.ApplicationProducts[i].ProductItemList[j].ManufacturerDate, 'yyyy/MM/dd');
                        $scope.model.Application.ApplicationProducts[i].ProductItemList[j].ExpiryDate = $filter('date')($scope.model.Application.ApplicationProducts[i].ProductItemList[j].ExpiryDate, 'yyyy/MM/dd');
                    }
                }
            };
            if ($scope.model.Application.Key == null) {
                $scope.model.Application.TradeType = "4";
                $scope.model.Application.ShippingMethod = 1;
            }

            $scope.isEdit = $scope.model.Application.Key != null;
            $scope.dataInit();
            $scope.errors = [];

            if ($scope.model.Application.Key != null) {

                $scope.acceptshow = false;
                $scope.appshow = true;
                $("#appliction-form").show();
            } else {
                $scope.acceptshow = true;
                $scope.appshow = false;
                $("#accept-form").hide();
            }
            $scope.additem = function () {
                $scope.model.Application.ApplicationProducts.push({
                    DescriptionEn: "",
                    Description: "",
                    Brand: "",
                    HSCode: "",
                    Spec: "",
                    CiqCode: "",
                    Manufacturer: "",
                    ManufacturerCountry: "",
                    Package: "",
                    Quantity: 0,
                    ApplicationZCodes: [],
                    ProductItemList: [
                        {
                            BatchNo: "",
                            Quantity: 0.0,
                            ManufacturerDate: null,
                            ExpiryDate: null,
                            HandlerType: 1
                        }
                    ],
                    HandlerType: 1
                });
            };
            $(function () {
                $('.datetimepicker').datetimepicker({
                    language: 'zh-CN',
                    format: 'yyyy/mm/dd',
                    autoclose: true,
                    minView: "month",
                    todayBtn: true,
                }).on("hide",
                    function () {
                        var $this = $(this);
                        var _this = this;
                        $scope.$apply(function () {
                            $scope[$this.attr('ng-model')] = _this.value;
                        });
                    });
            });

            $scope.listFilter = function (item) {
                return item.HandlerType === 1 || item.HandlerType === 0;
            };

            $scope.addContainerInfo = function () {
                $scope.model.Application.ContainerInfos
                    .push({ ContainerNumber: "", SealNumber: "", HandlerType: 1 });
            };
            $scope.removeContainerInfo = function (_object) {
                _object.HandlerType = -1;
            };
            $scope.merchantProductList = { CiqCode: 0, Description: "" };
            $scope.removeitem = function (_object) {
                _object.HandlerType = -1;
                for (var j = 0; j < _object.ProductItemList.length; j++) {
                    _object.ProductItemList[j].HandlerType = -1;
                }
                for (var j = 0; j < _object.ApplicationZCodes.length; j++) {
                    _object.ApplicationZCodes[j].HandlerType = -1;
                }
            };
            $scope.AppCache = null;
            $scope.GetAppCache = function () {
                $http({
                    url: '/api/forms/GetAppCache',
                    method: 'POST'
                }).success(function (response) {
                    if (response.flag) {
                        // $scope.isNewApp = true;
                        $scope.AppCache = response.app;
                    }
                }).error(function (response) {
                    $log.warn(response);
                });
            }
            if ($scope.isNewApp) {
                $scope.GetAppCache();
            }

            $scope.RemoveAppCache = function (isOverride) {
                $scope.accept();
                if (isOverride) {
                    $scope.model.Application = null;
                    $scope.model.Application = $scope.AppCache;
                    $scope.dataInit();
                }
                $http({
                    url: '/api/forms/RemoveAppCache',
                    method: 'POST'
                }).success(function (response) {
                    alertService.add('success', "读取成功 (并已删除了暂存的申请,若需暂存,请再次点击暂存)", 6000);
                    $location.hash("h1");
                    $anchorScroll();

                }).error(function (response) {
                    alertService.add('danger', "删除暂存的申请失败)", 5000);
                    $location.hash("h1");
                    $anchorScroll();
                });
            }
            $scope.isSaveingCache = false;
            $scope.SaveAppCache = function () {
                $scope.isSaveingCache = true;
                $http({
                    url: '/api/forms/SaveAppCache',
                    method: 'POST',
                    data: $scope.model.Application
                }).success(function (result) {
                    alertService.add('success', "暂存成功,下次可以直接读取本次保存的数据", 3000);
                    $location.hash("h1");
                    $anchorScroll();
                    $scope.isSaveingCache = false;
                }).error(function (response) {
                    alertService.add('danger', "保存失败", 5000);
                    $location.hash("h1");
                    $anchorScroll();
                    $scope.isSaveingCache = false;
                });
            }
            $scope.getGoodsList = function () {
                $http({
                    url: '/api/goods/getproductlist',
                    method: 'POST'
                }).success(function (response) {
                    $scope.merchantProductList = response.result;
                }).error(function (response) {
                    $log.warn(response);
                });
            }
            $scope.getGoodsList();
            $scope.getCustomProductList = function () {
                $http.post('/api/goods/getcustomproductlist').success(function (response) {
                    $scope.customProductList = response.result;
                });
            };
            $scope.getCustomProductList();


            $scope.selectProduct = function (_selected, _object) {
                if (_selected != null) {
                    _object.DescriptionEn = _selected.DescriptionEn;
                    _object.IsEditDescriptionEn = !_selected.IsApproved;
                    _object.Description = _selected.Description;
                    _object.Brand = _selected.Brand;
                    _object.HSCode = _selected.HsCode;
                    _object.Spec = _selected.Spec;
                    _object.CiqCode = _selected.CiqCode;
                    _object.Manufacturer = _selected.Manufacturer;
                    _object.ManufacturerCountry = _selected.ManufacturerCountry;
                    _object.Package = _selected.Package;
                    _object.ProductItemList = [
                        {
                            BatchNo: "",
                            Quantity: 0.0,
                            ManufacturerDate: null,
                            ExpiryDate: null,
                            HandlerType: 1
                        }
                    ];
                    _object.ApplicationZCodes = [];
                } else {
                    _object.DescriptionEn = "";
                    _object.Description = "";
                    _object.Brand = "";
                    _object.HSCode = "";
                    _object.Spec = "";
                    _object.CiqCode = "";
                    _object.Manufacturer = "";
                    _object.ManufacturerCountry = "036";
                    _object.Package = "";
                    _object.ProductItemList = [
                        {
                            BatchNo: "",
                            Quantity: 0.0,
                            ManufacturerDate: null,
                            ExpiryDate: null,
                            HandlerType: 1
                        }
                    ];
                    _object.ApplicationZCodes = [];
                    _object.isEditInputDefault = true;
                }
                _object.Selected = _selected;
            };
            $scope.addItemByBatchNo = function (_object) {
                _object.ProductItemList.push({
                    ManufacturerDate: "",
                    ExpiryDate: "",
                    BatchNo: "",
                    Quantity: 0,
                    HandlerType: 1
                });
            };

            $scope.removeItemByBatchNo = function (_object) {
                _object.HandlerType = -1;
            };
            $scope.addZcodeItem = function (_object) {
                _object.ApplicationZCodes.push({
                    ZCodeStart: "",
                    ZCodeEnd: "",
                    HandlerType: 1
                });
            };
            $scope.removeZcodeItem = function (_object) {
                _object.HandlerType = -1;
            };

            $scope.Product = null;
            $scope.getproductlist = function () {
                if ($scope.CiqCode != "") {
                    $http({
                        url: '/api/goods/searchproduct',
                        method: 'POST',
                        data: {
                            ciqCode: $scope.CiqCode
                        }
                    }).success(function (data) {
                        $scope.Product = data.result;
                    }).error(function (data, header, config, status) {
                    });
                }
            }

            $scope.selectGoods = function (index) {
                $http({
                    url: '/api/goods/searchproduct',
                    method: 'POST',
                    data: {
                        ciqCode: $scope.merchantProductList[index].CiqCode
                    }
                }).success(function (data) {
                    var product = data.result;
                    $scope.model.Application.ApplicationProducts.push({
                        CiqCode: product.CiqCode,
                        HSCode: product.HSCode,
                        Description: product.Description,
                        DescriptionEn: product.DescriptionEn,
                        Spec: product.Spec,
                        Brand: product.Brand,
                        Manufacturer: product.Manufacturer,
                        ManufacturerCountry: product.ManufacturerCountry,
                        Package: product.Package
                    });
                }).error(function (data, header, config, status) {
                });
            }
            $scope.itemClickHandler = function (event) {
                var currentElement = event.target;
                //console.log(currentElement);
                $(currentElement).datetimepicker({
                    language: 'zh-CN',
                    format: 'yyyy/mm/dd',
                    autoclose: true,
                    minView: "month",
                    todayBtn: true,
                }).on("hide",
                function () {
                    var $this = $(this);
                    var _this = this;
                    $scope.$apply(function () {
                        $scope[$this.attr('ng-model')] = _this.value;
                    });
                });
            };
            $scope.countryClickHandler = function (event) {
                var currentElement = event.target;
                $(currentElement).select2({ theme: "bootstrap", width: 'resolve' });
            };
            $scope.accept = function () {
                $scope.acceptshow = false;
                $scope.appshow = true;
                $("#accept-form").hide();
                $("#appliction-form").show();
            };

            $scope.check_type_c102 = function () {
                if ($scope.model.Application.C102) {
                    $scope.show_c_102 = true;
                } else {
                    $scope.show_c_102 = false;
                }
            };

            $scope.removeExample = function (_object) {
                _object.HandlerType = -1;
            };
            $scope.check_type_c102();

            /*login model*/
            $scope.login = {
                result: true,
                error: ""
            };
            $scope.user = {
                email: "",
                password: ""
            }
            $scope.submitLoginForm = function () {
                console.log($scope.user);
                $http.post('/api/account/login', $scope.user).then(function (response) {
                    if (response.data.result) {
                        $('#form-login').modal('hide');
                    } else {
                        //console.log(response.data);
                        $scope.login.result = response.data.result;
                        $scope.login.error = response.data.message;
                    }
                });
            };

            $scope.submit = function () {
                if ($scope.model.Application.ShippingMethod == 1) {
                    $scope.model.Application.ContainerInfos = [];
                }
                for (var i = 0; i < $scope.model.Application.ApplicationProducts.length; i++) {
                    $scope.model.Application.ApplicationProducts[i].Index = i;
                    for (var j = 0; j < $scope.model.Application.ApplicationProducts[i].ProductItemList.length; j++) {
                        $scope.model.Application.ApplicationProducts[i].ProductItemList[j].ManufacturerDate = $filter('date')($scope.model.Application.ApplicationProducts[i].ProductItemList[j].ManufacturerDate, 'yyyy/MM/dd');
                        $scope.model.Application.ApplicationProducts[i].ProductItemList[j].ExpiryDate = $filter('date')($scope.model.Application.ApplicationProducts[i].ProductItemList[j].ExpiryDate, 'yyyy/MM/dd');
                    }
                    if (!$scope.show_c_102) {
                        $scope.model.Application.ApplicationProducts[i].C102 = false;
                        $scope.model.Application.ApplicationProducts[i].C102Comment = "";
                    }
                }
                $scope.submitApp = true;
                $http.post('/forms/app', $scope.model.Application).then(function (response) {
                    if (response.data.isLogin) {
                        if (response.data.errors) {
                            $scope.errors = response.data.errors;
                            $location.hash("h1");
                            $anchorScroll();
                            $scope.dataInit();
                        } else {
                            $scope.resultMessage = response.data.isNew ? "证书申请成功！申请编号为" + response.data.appkey : "数据更新成功";
                        }
                    } else {
                        $scope.login = { result: true, error: "" };
                        $scope.user = { email: "", password: "" }
                        $('#form-login').modal();
                    }
                    $scope.submitApp = false;
                },
                function (response) {
                    $scope.errors = ["服务器异常,请重试"];
                    $location.hash("h1");
                    $anchorScroll();
                    $scope.submitApp = false;
                    $log.warn(response);
                });
            };

            $scope.updateClock = function () {
                $http.post('/api/account/heartbeat').then(function () { });
            };
            setInterval(function () {
                $scope.$apply($scope.updateClock);
            }, 300000);

            $scope.updateClock();

            $scope.loadCountriesDict = null;
            $scope.loadCountries = function () {
                $http.get("/api/dict/countries", { params: { 'code': "" } }).success(function (data) {
                    $scope.loadCountriesDict = data.items;
                }).error(function (data) {
                });
            };
            $scope.loadCountries();
            $("#accept-form").show();

            //merchant list
            $scope.merchantList = function () {
                $("#form-merchant-list").modal("show");
            };

            $scope.loadMerchantInfo = null;
            $scope.loadMerchant = function () {
                $http.post("/api/UserProfile/GetProfileList", { params: {} }).success(function (data) {
                    $scope.loadMerchantInfo = data.result;
                }).error(function (data) {
                });
            };
            $scope.loadMerchant();
            $scope.selectExporter = function (_object) {
                if (_object) {
                    $scope.model.Application.Exporter = _object.UserName;
                    $scope.model.Application.ExporterAddr = _object.UserAddress;
                    $scope.model.Application.ExporterContact = _object.UserContact;
                    $scope.model.Application.ExporterPhone = _object.UserPhone;
                } else {
                    $scope.model.Application.Exporter = "";
                    $scope.model.Application.ExporterAddr = "";
                    $scope.model.Application.ExporterContact = "";
                    $scope.model.Application.ExporterPhone = "";
                }
            };
            $scope.selectImporter = function (_object) {
                if (_object) {
                    $scope.model.Application.Importer = _object.UserName;
                    $scope.model.Application.ImporterAddr = _object.UserAddress;
                    $scope.model.Application.ImporterContact = _object.UserContact;
                    $scope.model.Application.ImporterPhone = _object.UserPhone;
                } else {
                    $scope.model.Application.Importer = "";
                    $scope.model.Application.ImporterAddr = "";
                    $scope.model.Application.ImporterContact = "";
                    $scope.model.Application.ImporterPhone = "";
                }
            };
            $scope.selectImBroker = function (_object) {
                if (_object) {
                    $scope.model.Application.ImBroker = _object.UserName;
                    $scope.model.Application.ImBrokerAddr = _object.UserAddress;
                    $scope.model.Application.ImBrokerContact = _object.UserContact;
                    $scope.model.Application.ImBrokerPhone = _object.UserPhone;
                } else {
                    $scope.model.Application.ImBroker = "";
                    $scope.model.Application.ImBrokerAddr = "";
                    $scope.model.Application.ImBrokerContact = "";
                    $scope.model.Application.ImBrokerPhone = "";
                }
            };
            $scope.addMerchant = function () {
                $(".merchant-add-title").html("添加常用商户信息");
                $scope.dialogModelMerchant = {
                    UserName: "",
                    UserAddress: "",
                    UserContact: "",
                    UserPhone: ""
                };
                $("#merchant-add").modal("show");
                $("#form-merchant-list").modal("hide");
            };

            $scope.submitAddMerchant = function () {
                var _url = "";
                if ($scope.dialogModelMerchant.Id == null) {
                    _url = '/api/UserProfile/AddProfile';
                } else {
                    _url = '/api/UserProfile/UpdateProfile';
                }
                $http({
                    url: _url,
                    method: 'POST',
                    data: {
                        userProfile: $scope.dialogModelMerchant
                    }
                }).success(function (data) {
                    if (data.flag) {
                        $scope.loadMerchant();
                        $("#merchant-add").modal("hide");
                        $("#form-merchant-list").modal("show");
                    } else {
                        var _errormsg = '';
                        for (var i = data.errorMsg.length; i > 0; i--) {
                            _errormsg += data.errorMsg[i - 1] + "\r\n";
                        }
                        alertService.add("danger", _errormsg || "未知错误", 3000);
                    }
                }).error(function (response) {
                    alertService.add("danger", response || "未知错误", 3000);
                });
            };
            $scope.editMerchant = function (_id) {
                $http({
                    url: '/api/UserProfile/GetProfileDeatil',
                    method: 'POST',
                    data: {
                        ProfileId: _id
                    }
                }).success(function (data) {
                    $scope.dialogModelMerchant = data.result;
                }).error(function (response) {
                });
                $(".merchant-add-title").html("编辑常用商户信息");
                $("#merchant-add").modal("show");
                $("#form-merchant-list").modal("hide");
            };
            $scope.removeMerchant = function (_object) {
                if (confirm("是否删除该常用商户")) {
                    $http({
                        url: '/api/UserProfile/RemoveProfile',
                        method: 'POST',
                        data: {
                            ProfileId: _object.Id
                        }
                    }).success(function (data) {
                        if (data.flag) {
                            $scope.loadMerchant();
                            //$("#merchant-add").modal("hide");
                        }
                    }).error(function (response) {
                        alertService.add("danger", response.msg || "未知错误", 3000);
                    });
                }
            };

            //upload example
            $scope.UploadExample = function () {
                $('#uploadForm').ajaxSubmit({
                    type: "post",
                    url: "/api/forms/savefile",
                    success: function (data) {
                        if (data.filepath != "") {
                            $scope.model.Application.ExampleCertList.push({ CertFilePath: data.filepath, HandlerType: 1 });
                            $scope.$apply();
                        }
                    }
                });
            };
            $scope.UploadExampleNew = function () {
                $('#uploadForm').ajaxSubmit({
                    type: "post",
                    url: "/file/UploadExampleFile",
                    success: function (data) {
                        if (data.Flag) {
                            console.log(data.FileFullPath);
                            //  $scope.model.Application.ExampleCertList.push({ CertFilePath: data.FileFullPath, HandlerType: 1 });
                            //$scope.$apply();
                        } else {
                            alert(data.Msg);
                        }
                    }
                });
            };
            $scope.showProductList = function () {
                $(".form-add-custom-product-title").html("商品列表");
                $("#form-product").modal("show");
                $("#form-add-custom-product").modal("hide");
                $("#form-add-goods-product").modal("hide");
            };
            $scope.addCustomProduct = function () {
                $(".form-add-custom-product-title").html("添加非备案商品");
                $("#form-product").modal("hide");
                $("#form-add-custom-product").modal("show");
                $("#CustomDialogModelHsCode").next().find("span.select2-selection__rendered").html("");
                $scope.CustomDialogModel = { HsCode: '', ManufacturerCountry: "036" };
            };
            $scope.addGoodsProduct = function () {
                $("#form-product").modal("hide");
                $("#form-add-goods-product").modal("show");
                $scope.DialogProductCiqCode = "";
                $scope.dialogProductList = null;
            };
            $scope.submitAddCustomProduct = function () {
                var _btnsubmitAddCustomProduct = document.getElementById("submitAddCustomProduct");
                angular.element(_btnsubmitAddCustomProduct).attr("disabled", true);
                $http.post('/api/goods/addcustomproduct', $scope.CustomDialogModel).success(function (response) {
                    if (response.flag) {
                        $scope.getCustomProductList();
                        alert("提交成功");
                        $scope.showProductList();
                        //$("#form-add-custom-product").modal("hide");
                        angular.element(_btnsubmitAddCustomProduct).attr("disabled", false);
                    }
                    var _tipType = response.flag ? "success" : "danger";
                    alertService.add(_tipType, response.msg || "未知错误", 3000);
                });
            };
            $scope.submitAddGoodsProduct = function () {
                $http.post('/api/goods/addcustomproduct', $scope.CustomDialogModel).success(function (response) {
                    if (response.flag) {
                        $scope.getGoodsList();
                        alert("提交成功");
                        $scope.showProductList();
                        //$("#form-add-custom-product").modal("hide");
                    }
                    var _tipType = response.flag ? "success" : "danger";
                    alertService.add(_tipType, response.msg || "未知错误", 3000);
                });
            };
            $scope.getDialogProductList = function () {
                if ($scope.DialogProductCiqCode != "" && $scope.DialogProductCiqCode != null) {
                    var reg = /^\d{10}$/;
                    var reg2 = /^ICIP\d{14}$/i;
                    if (!(reg.test($scope.DialogProductCiqCode) || reg2.test($scope.DialogProductCiqCode))) {
                        $scope.Product = null;
                        alertService.add('danger', "正确的备案号格式为[ICIP+14个数字]或[10个数字]", 3000);
                        return;
                    }
                    $http({
                        url: '/api/goods/searchproduct',
                        method: 'POST',
                        data: {
                            ciqCode: $scope.DialogProductCiqCode
                        }
                    }).success(function (data) {
                        if (data.result == null) {
                            $scope.dialogProductList = null;
                            alertService.add('danger', "该备案号不存在", 3000);
                        } else {
                            $scope.dialogProductList = data.result;
                        }
                    }).error(function () {
                    });
                } else {
                    $scope.dialogProductList = null;
                    alertService.add('danger', "请输入备案编号", 3000);
                }
            };
            $scope.addDialogGoodsProduct = function () {
                if (confirm('是否添加该商品为常用商品')) {
                    if ($scope.dialogProductList != null) {
                        $http({
                            url: '/api/goods/addproduct',
                            method: 'POST',
                            data: {
                                ciqCode: $scope.dialogProductList.CiqCode
                            }
                        }).success(function (data) {
                            if (data.result) {
                                $scope.getGoodsList();
                                alert("提交成功");
                                $scope.showProductList();
                            }
                            var _tipType = data.result ? "success" : "danger";
                            alertService.add(_tipType, data.msg || "未知错误", 3000);
                        }).error(function () {
                        });
                    }
                }
            };
            $scope.removeMerchantProductId = function (Id, index) {
                if (confirm("您确定要删除该商品吗?")) {
                    $http.post('/api/goods/deletecustomproduct', { id: Id }).then(function (response) {
                        if (response.data.flag) {
                            $scope.getCustomProductList();
                        }
                    });
                }
            };
            $scope.removeMerchantProductCiq = function (ciqCode, index) {
                if (confirm("您确定要删除该商品吗?")) {
                    $http.post('/api/goods/delete', { ciqCode: ciqCode }).then(function (response) {
                        if (response.data.result) {
                            $scope.getGoodsList();
                        }
                    });
                }
            };

            $scope.editMerchantProduct = function (_object) {
                $(".form-add-custom-product-title").html("编辑非备案商品");
                $scope.CustomDialogModel = _object;
                $("#CustomDialogModelHsCode").next().find("span.select2-selection__rendered").html("");
                $("#form-add-custom-product").modal("show");
                $("#form-product").modal("hide");
            };
        }
        ]);

        function CheckIsUpload() {
            var flag = $('#isUpload').val() * 1 === 1;
            $('#isUpload').val(0);
            return flag;
        }

        function print() {
            //var printWindow = window.open();
            //printWindow.document.write("<style type='text/css'>body {margin: 0px}</style>" + $("#print").html());
            //printWindow.print();
            $("#print").jqprint();
        }

        function ChangeUploadStatus() {
            $('#isUpload').val(1);
        }
    </script>
}

<div ng-controller="GlobalController" class="container">
    <div ng-show="acceptshow" id="accept-form" style="display: none; margin: 20px 0 0 0;">
        <form class="form-horizontal">
            <div class="form-group">
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="termblock">
                        <h5>委托检验申请单/协议书合同条款</h5>
                        <p>
                            一、环球质量检验公正有限公司（以下简称检验方）接受委托方书面检验委托。委托检
                            验申请单（以下简称委托单）作为本协议的附件。本协议以委托方代表人在委托单上签
                            名盖章，检验方加盖受理骑缝章后生效。<br />
                            1,Global Independent QC and Inspection Pty Ltd (GIQCI) operate inspection(s) in accordance
                            with a written delegation agreement, to which an application form is attached. The agreement
                            shall become effective upon the signature and seal from the entrusting party, together with the
                            seal on the perforation from GIQCI.
                        </p>
                        <p>
                            二、委托方应如实填写委托单，如有必要，还应根据检验方的要求提供必要的单据及相
                            关资料。<br />
                            2,The details in application form shall be filled carefully. Additional documents and information
                            may be required.
                        </p>
                        <p>
                            三、检验方按委托方在委托单上填明的检验要求进行检验，并出具检验报告。<br />
                            3,GIQCI give report in accordance with the application form, on which details shall be filled by
                            the entrusting party.
                        </p>
                        <p>
                            四、委托方必须注明要求使用的检验方法。<br />
                            4,The inspection method(s) shall be specified by the entrusting party.
                        </p>
                        <p>
                            五、检验方的检验时间根据检验内容而定，原则上以检验方公布的时间为准，特殊情况
                            双方协商确定，并在委托单上注明。<br />
                            5,The length of inspection period is made according to the inspection subject, which shall be
                            published by GIQCI. For special cases, the inspection period shall be negotiated by both parties
                            and noted on the application form.
                        </p>
                        <p>
                            六、检验方检验收费按有关规定计价。对于批量样品如需减免检验费用的，委托方应在
                            委托时与检验方协商确定，并在委托单上“备注”栏内注明。要求加急服务的，需支付加急
                            费。<br />
                            6,Fees will be charged. Waiver can be applied for bulk samples, which shall be negotiated by
                            both parties and noted on the application form. For express service, an additional charge will be
                            applied.
                        </p>
                        <p>
                            七、检验方接受委托方自送样品的检验，检验报告仅对样品负责。<br />
                            7,The inspection report is issued based on the sample(s) offered from the entrusting party.
                        </p>
                        <p>
                            八、检验方在接受委托时，须详细审核委托单内容。在确认委托方的委托及要求后，应
                            填写委托单同一页上的领证凭条交付委托方，委托人凭此查询及索取检验报告。<br />
                            8,Details on the application form shall be confirmed by GIQCI. The collection slip shall be kept
                            by the entrusting party to make inquiry and collect inspection report.
                        </p>
                        <p>
                            九、检验方的检验报告有固定的格式，并仅提供唯一正本。如对检验报告有特殊要求，
                            委托方应在委托单上“备注”栏内注明。<br />
                            9,Only one formal report shall be available, which has fixed format. Special requirements need
                            to be noted by the entrusting party.
                        </p>
                        <p>
                            十、请确保上述资料填写正确，报告完成后如需修改报告内容，将收取报告修改费<br />
                            10,Please ensure the accuracy of the information. Revision fee will be
                            charged after report issuance.
                        </p>
                        <p>
                            十一、委托方如对检验结果有异议的，须在一个月内凭检验证书原件向检验方要求复检，
                            检验方应在三日内给予答复。如同意复检，检验方应于十日内安排。<br />
                            11,After the report is issued, review can be applied within one month, if the entrusting party
                            objects to the inspection result. GIQCI shall give reply within three days. If GIQCI agree to carry
                            out a review, a new inspection shall be given in then days.
                        </p>
                        <p>
                            十二、复检结果维持原检验结果的，委托方须按规定向检验方支付复检费。复检结果确
                            认原检验结果有误的，检验方不再收取复检费。<br />
                            12,If the outcome remains unchanged, review fee will be charged. Otherwise, no fee occurs.
                        </p>
                        <p>
                            十三、委托方对复检结果仍有异议，双方协商不成时，应与检验方书面协议，委托仲裁
                            机构仲裁。<br />
                            13,In case the entrusting party disagrees with the review result, the entrusting party shall make
                            written agreement with GIQCI to send claim to arbitration.
                        </p>
                        <p>
                            十四、委托方对本协议及委托单有不明之处，应在填写委托单时，向检验方工作人员咨
                            询。协议自填单之日起生效。<br />
                            14,Please fill up the application form carefully with the relevant and required details. Assistance
                            is available from GIQCI.
                        </p>
                        <p>
                            十五、此表信息可能在实验室评审过程中被评审机构接触。<br />
                            15,Information of the application form may be reviewed by the accredit organization.
                        </p>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-4" ng-class="{'col-sm-offset-5':AppCache==null,'col-sm-offset-4':AppCache!=null}">
                    <button class="btn btn-default" ng-click="accept()">
                        <span class="glyphicon glyphicon-ok-circle" aria-hidden="true"></span> 我接受以上合同条款
                    </button>
                    <button class="btn btn-success" ng-show="AppCache!=null" ng-click="RemoveAppCache(true)">
                        <span class="glyphicon glyphicon-level-up" aria-hidden="true"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;读取暂存的申请&nbsp;&nbsp;&nbsp;
                    </button>
                </div>
            </div>
        </form>
    </div>

    <div ng-show="appshow" id="appliction-form" style="display: none;">
        <div class="alert alert-success" role="alert" ng-show="resultMessage">
            <strong>信息提示</strong>
            <p>{{resultMessage}}</p>
            <p>
                <a href="/forms/app" target="_self">再次申请</a>
            </p>
        </div>

        <div ng-show="!resultMessage">
            <h1 id="h1">证书申请表格</h1>
            <div class="has-error" ng-show="errors.length > 0">
                <ul class="help-block">
                    <li ng-repeat="err in errors">{{err}}</li>
                </ul>
            </div>
            <div role="alert" id="alertBox" class="alert alert-dismissible alert-{{alert.type}}" ng-repeat="alert in alerts">
                <button aria-label="Close" data-dismiss="alert" ng-click="alert.close()" class="close" type="button"><span aria-hidden="true">×</span></button>
                <span ng-bind="alert.msg"></span>
            </div>
            <div><span style="color: red;">*</span> 带星号的为必填项</div>
            <form name="appform" class="form-horizontal" method="POST" novalidate enctype="multipart/form-data" id="uploadForm" onsubmit="return CheckIsUpload();">
                <div class="form-group">

                    <label class="col-sm-2 control-label">证书类别 <span style="color: red;">*</span></label>

                    <div class="col-sm-10">
                        <div class="checkbox">
                            <label><input type="checkbox" name="Application.C101" ng-model="model.Application.C101" /> 溯源证书</label>
                            <label><input type="checkbox" name="Application.C102" ng-model="model.Application.C102" ng-click="check_type_c102()" /> 品质证书</label>
                            <label><input type="checkbox" name="Application.C103" ng-model="model.Application.C103" /> 标签证书</label>
                        </div>
                    </div>
                </div>
                <div class="form-group" ng-show="model.Application.C103">
                    @*<input type="file" name="file" onchange="if ($(this).val() != '') {angular.element(this).scope().UploadExampleNew()}" />*@
                    <label class="col-sm-2 control-label">上传标签证书样张</label>
                    <div class="col-sm-10">
                        <input type="file" name="file" onchange="if ($(this).val() != '') {angular.element(this).scope().UploadExample()}" />
                        <div ng-repeat="item in model.Application.ExampleCertList | filter:listFilter">
                            <table class="table table-striped goodsItems">
                                <tr>
                                    <th>样张{{$index+1}}</th>
                                    <td>
                                        <button class="btn btn-default" ng-click="removeExample(item)">
                                            <span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span> 删除
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <th>文件</th>
                                    <td>
                                        <input ng-show="!item.CertFilePath" type="file" name="file{{$index}}" ng-model="item.CertFilePath" class="form-control autowidth-form-control" />
                                        <a ng-show="item.CertFilePath" href="{{item.CertFilePath}}" target="_blank">查看样张{{$index+1}}</a>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="form-group">

                    <label class="col-sm-2 control-label">商业目的 <span style="color: red;">*</span></label>

                    <div class="col-sm-10">
                        <div class="radio">
                            <label><input type="radio" name="Application.TradeType" ng-model="model.Application.TradeType" value="4" /> 一般贸易</label>
                            <label><input type="radio" name="Application.TradeType" ng-model="model.Application.TradeType" value="1" /> 电商贸易</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">申请企业备案号</label>
                    <div class="col-sm-10">
                        <p class="form-control-static">
                            <input type="hidden" name="Application.ApplicantCode" ng-model="model.Application.ApplicantCode" />{{model.Application.ApplicantCode}}
                        </p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">申请人 <span style="color: red;">*</span></label>

                    <div class="col-sm-10">
                        <input type="text" maxlength="100" name="Application.Applicant" ng-model="model.Application.Applicant" class="form-control" placeholder="全称" />
                        <input type="text" maxlength="400" name="Application.ApplicantAddr" ng-model="model.Application.ApplicantAddr" class="form-control" placeholder="地址" />
                        <input type="text" maxlength="100" name="Application.ApplicantContact" ng-model="model.Application.ApplicantContact" class="form-control" placeholder="联系人" />
                        <input type="text" maxlength="100" name="Application.ApplicantPhone" ng-model="model.Application.ApplicantPhone" class="form-control" placeholder="联系电话" />
                        <input type="text" maxlength="100" name="Application.ApplicantEmail" ng-model="model.Application.ApplicantEmail" class="form-control" placeholder="邮箱" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">出口商 <span style="color: red;">*</span> </label>

                    <div class="col-sm-6">
                        <select class="form-control" ng-change="selectExporter(Exporter)" ng-model="Exporter" ng-options="merchant.UserName for merchant in loadMerchantInfo">
                            <option value="">--请选择--</option>
                        </select>
                    </div>
                    <div class="col-sm-4">
                        <button class="btn btn-default" type="button" ng-click="merchantList()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> 常用商户管理</button>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <input type="text" maxlength="100" name="Application.Exporter" ng-model="model.Application.Exporter" class="form-control" placeholder="全称" />
                        <input type="text" maxlength="400" name="Application.ExporterAddr" ng-model="model.Application.ExporterAddr" class="form-control" placeholder="地址" />
                        <input type="text" maxlength="100" name="Application.ExporterContact" ng-model="model.Application.ExporterContact" class="form-control" placeholder="联系人" />
                        <input type="text" maxlength="100" name="Application.ExporterPhone" ng-model="model.Application.ExporterPhone" class="form-control" placeholder="联系电话" />
                    </div>
                </div>
                <div class="form-group" ng-show="model.Application.TradeType==4">
                    <label class="col-sm-2 control-label">进口商 <span style="color: red;">*</span> </label>

                    <div class="col-sm-6">
                        <select class="form-control" ng-change="selectImporter(Importer)" ng-model="Importer" ng-options="merchant.UserName for merchant in loadMerchantInfo">
                            <option value="">--请选择--</option>
                        </select>
                    </div>
                    <div class="col-sm-4">
                        <button class="btn btn-default" type="button" ng-click="merchantList()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> 常用商户管理</button>
                    </div>
                </div>
                <div class="form-group" ng-show="model.Application.TradeType==4">
                    <div class="col-sm-offset-2 col-sm-10">
                        <input type="text" maxlength="100" name="Application.Importer" ng-model="model.Application.Importer" class="form-control" placeholder="全称" />
                        <input type="text" maxlength="400" name="Application.ImporterAddr" ng-model="model.Application.ImporterAddr" class="form-control" placeholder="地址" />
                        <input type="text" maxlength="100" name="Application.ImporterContact" ng-model="model.Application.ImporterContact" class="form-control" placeholder="联系人" />
                        <input type="text" maxlength="100" name="Application.ImporterPhone" ng-model="model.Application.ImporterPhone" class="form-control" placeholder="联系电话" />
                    </div>
                </div>
                <div class="form-group" ng-show="model.Application.TradeType==1">
                    <label class="col-sm-2 control-label">代理进口商 <span style="color: red;">*</span></label>
                    <div class="col-sm-6">
                        <select class="form-control" ng-change="selectImBroker(ImBroker)" ng-model="ImBroker" ng-options="merchant.UserName for merchant in loadMerchantInfo">
                            <option value="">--请选择--</option>
                        </select>
                    </div>
                    <div class="col-sm-4">
                        <button class="btn btn-default" type="button" ng-click="merchantList()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> 常用商户管理</button>
                    </div>
                </div>
                <div class="form-group" ng-show="model.Application.TradeType==1">
                    <div class="col-sm-offset-2 col-sm-10">
                        <input type="text" maxlength="100" name="Application.ImBroker" ng-model="model.Application.ImBroker" class="form-control" placeholder="全称" />
                        <input type="text" maxlength="400" name="Application.ImBrokerAddr" ng-model="model.Application.ImBrokerAddr" class="form-control" placeholder="地址" />
                        <input type="text" maxlength="100" name="Application.ImBrokerContact" ng-model="model.Application.ImBrokerContact" class="form-control" placeholder="联系人" />
                        <input type="text" maxlength="100" name="Application.ImBrokerPhone" ng-model="model.Application.ImBrokerPhone" class="form-control" placeholder="联系电话" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">商品资料</label>
                    <div class="col-sm-10">
                        <div ng-repeat="item in model.Application.ApplicationProducts | filter:listFilter">
                            <table class="table table-striped">
                                <colgroup>
                                    <col width="120" />
                                    <col width="360" />
                                    <col width="120" />
                                    <col width="360" />
                                </colgroup>
                                <tr>
                                    <th>
                                        <p class="form-control-static">商品 {{$index+1}}</p>
                                    </th>
                                    <td colspan="3">
                                        <button class="btn btn-default" type="button" ng-click="removeitem(item)"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span> 删除</button>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">常用商品 <span style="color: red;">*</span></p>
                                    </th>
                                    <td colspan="3">
                                        <div class="form-group">
                                            <div class="col-sm-8">
                                                <p class="form-control-static" ng-if="isEdit&&item.HandlerType!=1">{{item.CiqCode?item.CiqCode:"-"}}</p>
                                                <select ajax-product class="form-control" ng-if="!isEdit||(isEdit&&item.HandlerType==1)" ng-change="selectProduct(select,item)" ng-model="select" style="width:100%;"></select>
                                                <input type="hidden" ng-model="item.CiqCode" />
                                            </div>
                                            <div class="col-sm-4">
                                                <a class="btn btn-default" data-toggle="modal" data-target="#form-product"><span class="glyphicon glyphicon-link" aria-hidden="true"></span>&nbsp;常用商品管理</a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">名称(英文)</p>
                                    </th>
                                    <td>
                                        <span ng-show="!item.IsEditDescriptionEn">
                                            <p class="form-control-static break-word" ng-model="item.DescriptionEn">{{item.DescriptionEn}}</p>
                                        </span>
                                        <span ng-show="item.IsEditDescriptionEn">
                                            <input type="text" ng-model="item.DescriptionEn" class="form-control" maxlength="100" />
                                        </span>
                                    </td>
                                    <th>
                                        <p class="form-control-static">名称(中文)</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static break-word" ng-model="item.Description">{{item.Description}}</p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">品牌</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static break-word" ng-model="item.Brand">{{item.Brand}}</p>

                                    </td>
                                    <th>
                                        <p class="form-control-static">包装</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static" ng-model="item.Package">{{item.Package}}</p>

                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">规格</p>
                                    </th>
                                    <td>
                                        <p class="form-control-static" ng-model="item.Spec">{{item.Spec}}</p>
                                    </td>
                                    <th>
                                        <p class="form-control-static">原产国</p>
                                    </th>
                                    <td>
                                        <p ajax-label ajax-url="countries" ng-model="item.ManufacturerCountry" class="form-control-static">{{item.ManufacturerCountry}}</p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">HS编码</p>
                                    </th>
                                    <td>
                                        <p ajax-label ajax-url="commonhscodes" ng-model="item.HSCode" class="form-control-static">{{item.HSCode}}</p>
                                    </td>
                                    <th>
                                        <p class="form-control-static">制造商</p>
                                    </th>
                                    <td>

                                        <p class="form-control-static" ng-model="item.Manufacturer">{{item.Manufacturer}}</p>

                                    </td>
                                </tr>
                                <tr>
                                    <th>
                                        <p class="form-control-static">
                                            数量 <span style="color: red;">*</span>
                                        </p>
                                    </th>
                                    <td>
                                        <input type="number" ng-model="item.Quantity" class="form-control" placeholder="数量" min="0" />
                                    </td>
                                    <th>

                                    </th>
                                    <td></td>
                                </tr>
                                <tr ng-show="model.Application.C102">
                                    <th>
                                        <p class="form-control-static">品质检验</p>
                                    </th>
                                    <td>
                                        <div class="checkbox">
                                            <label><input type="checkbox" ng-model="item.C102" />是否检查</label>
                                        </div>
                                    </td>
                                    <th>
                                        <p class="form-control-static" ng-show="item.C102">检测项目 <span style="color: red;">*</span> </p>
                                    </th>
                                    <td>
                                        <span ng-show="item.C102"><input type="text" ng-model="item.C102Comment" class="form-control" maxlength="100" /></span>
                                    </td>
                                </tr>
                            </table>
                            <!--批次号-->
                            <div ng-repeat="batch in item.ProductItemList | filter:listFilter">
                                <table class="table table-striped">
                                    <colgroup>
                                        <col width="120" />
                                        <col width="360" />
                                        <col width="120" />
                                        <col width="360" />
                                    </colgroup>
                                    <tr>
                                        <th>
                                            <p class="form-control-static">商品批次 {{$index+1}}</p>
                                        </th>
                                        <td colspan="3">
                                            <button class="btn btn-default" type="button" ng-click="removeItemByBatchNo(batch)"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span> 删除批次</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            <p class="form-control-static">批次号</p>
                                        </th>
                                        <td>
                                            <input ng-if="batch.HandlerType==1" type="text" ng-model="batch.BatchNo" class="form-control" maxlength="100" />
                                            <p ng-if="batch.HandlerType==0" ng-model="batch.BatchNo" class="form-control-static">{{batch.BatchNo}}</p>
                                        </td>
                                        <th>
                                            <p class="form-control-static">保质期 <span style="color: red;">*</span></p>
                                        </th>
                                        <td>
                                            <input ng-if="batch.HandlerType==1" type="text" ng-model="batch.ExpiryDate" class="form-control datetimepicker" ng-mousedown="itemClickHandler($event)" />
                                            <p ng-if="batch.HandlerType==0" ng-model="batch.ExpiryDate" class="form-control-static">{{batch.ExpiryDate}}</p>
                                        </td>
                                    </tr>

                                </table>
                            </div>
                            <!--end 批次号-->
                            <!--真知码-->
                            <div ng-repeat="zcode in item.ApplicationZCodes | filter:listFilter">
                                <table class="table table-striped">
                                    <colgroup>
                                        <col width="120" />
                                        <col width="360" />
                                        <col width="120" />
                                        <col width="360" />
                                    </colgroup>
                                    <tr>
                                        <th>
                                            <p class="form-control-static">真知码 {{$index+1}}</p>
                                        </th>
                                        <td colspan="3">
                                            <button class="btn btn-default" type="button" ng-click="removeZcodeItem(zcode)"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span> 删除真知码</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            <p class="form-control-static">首码</p>
                                        </th>
                                        <td>
                                            <input ng-if="zcode.HandlerType==1" type="text" ng-model="zcode.ZCodeStart" class="form-control" />
                                            <p ng-if="zcode.HandlerType==0" ng-model="zcode.ZCodeStart" class="form-control-static">{{zcode.ZCodeStart}}</p>
                                        </td>
                                        <th>
                                            <p class="form-control-static">尾码</p>
                                        </th>
                                        <td>
                                            <input ng-if="zcode.HandlerType==1" type="text" ng-model="zcode.ZCodeEnd" class="form-control" />
                                            <p ng-if="zcode.HandlerType==0" ng-model="zcode.ZCodeEnd" class="form-control-static">{{zcode.ZCodeEnd}}</p>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <!--end真知码-->
                            <div class="">
                                <a class="btn btn-default" ng-click="addItemByBatchNo(item)"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>&nbsp;添加批次号</a>
                                <button class="btn btn-default" type="button" ng-click="addZcodeItem(item)"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> 添加真知码</button>
                            </div>
                            <div>
                                &nbsp;
                            </div>
                        </div>
                        <div class="">
                            <button class="btn btn-default" type="button" ng-click="additem()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> 添加商品</button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">运输方式</label>
                    <div class="col-sm-10">
                        <div class="radio">
                            <label><input type="radio" ng-model="model.Application.ShippingMethod" value="1" />空运</label>
                            <label><input type="radio" ng-model="model.Application.ShippingMethod" value="2" />海运</label>
                            <label><input type="radio" ng-model="model.Application.ShippingMethod" value="3" />陆运</label>
                        </div>
                    </div>
                </div>
                <div class="form-group" ng-show="model.Application.ShippingMethod == 2">
                    <label class="col-sm-2 control-label">船舶资料</label>
                    <div class="col-sm-10">
                        <div ng-repeat="item in model.Application.ContainerInfos | filter:listFilter">
                            <table class="table table-striped goodsItems">
                                <colgroup>
                                    <col width="120" />
                                    <col width="360" />
                                    <col width="120" />
                                    <col width="360" />
                                </colgroup>
                                <tr>
                                    <th><p class="form-control-static">装箱信息 {{$index+1}}</p></th>
                                    <td colspan="3">
                                        <button class="btn btn-default" type="button" ng-click="removeContainerInfo(item)"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span> 删除</button>
                                    </td>
                                </tr>
                                <tr>
                                    <th><p class="form-control-static">装箱号 <span style="color: red;">*</span></p></th>
                                    <td>
                                        <p class="form-control-static" ng-if="item.HandlerType==0" ng-model="item.ContainerNumber">{{item.ContainerNumber}}</p>
                                        <input type="text" ng-if="item.HandlerType==1" ng-model="item.ContainerNumber" class="form-control" placeholder="装箱号" />
                                    </td>
                                    <th><p class="form-control-static">铅封号 <span style="color: red;">*</span></p></th>
                                    <td>
                                        <p class="form-control-static" ng-if="item.HandlerType==0" ng-model="item.SealNumber">{{item.SealNumber}}</p>
                                        <input type="text" ng-if="item.HandlerType==1" ng-model="item.SealNumber" class="form-control" placeholder="铅封号" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <button class="btn btn-default" type="button" ng-click="addContainerInfo()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> 添加装箱信息</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        提单号
                    </label>
                    <div class="col-sm-6">
                        <input type="text" ng-model="model.Application.BillNo" class="form-control" placeholder="提单号" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        副提单号
                    </label>
                    <div class="col-sm-6">
                        <input type="text" ng-model="model.Application.OtherBillNo" class="form-control" placeholder="副提单号" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        <p ng-if="model.Application.ShippingMethod == 1">航班号</p>
                        <p ng-if="model.Application.ShippingMethod == 2">船舶号</p>
                        <p ng-if="model.Application.ShippingMethod == 3">车牌号</p>
                    </label>
                    <div class="col-sm-6">
                        <input type="text" ng-if="model.Application.ShippingMethod == 1" ng-model="model.Application.Vesselcn" class="form-control" placeholder="航班号" />
                        <input type="text" ng-if="model.Application.ShippingMethod == 2" ng-model="model.Application.Vesselcn" class="form-control" placeholder="船舶号" />
                        <input type="text" ng-if="model.Application.ShippingMethod == 3" ng-model="model.Application.Vesselcn" class="form-control" placeholder="车牌号" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">出发日期</label>
                    <div class="col-sm-6">
                        <input type="text" ng-model="model.Application.Voyage" class="form-control datetimepicker" placeholder="出发日期" />
                    </div>
                </div>
                <div class="form-group" ng-show="model.Application.ShippingMethod != 2">
                    <label class="col-sm-2 control-label">运输总数量 <span style="color: red;">*</span></label>
                    <div class="col-sm-6">
                        <input type="number" ng-model="model.Application.TotalUnits" class="form-control" min="0" placeholder="运输总数量" />
                    </div>
                    <div class="col-sm-4">
                        <p class="form-control-static">Pallets</p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">运输总重量 <span style="color: red;">*</span></label>

                    <div class="col-sm-6">
                        <input type="number" ng-model="model.Application.TotalWeight" class="form-control" min="0" placeholder="运输总重量" />
                    </div>
                    <div class="col-sm-4">
                        <p class="form-control-static">KG</p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">计划发货日期</label>
                    <div class="col-sm-10">
                        <input type="text" ng-model="model.Application.ShippingDate" class="form-control datetimepicker" placeholder="计划发货日期" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">预约检查日期 <span style="color: red;">*</span></label>

                    <div class="col-sm-10">
                        <input type="text" ng-model="model.Application.InspectionDate" class="form-control datetimepicker" placeholder="yyyy-MM-dd" />
                    </div>
                </div>
                <div class="form-group">

                    <label class="col-sm-2 control-label">检验地点 <span style="color: red;">*</span></label>

                    <div class="col-sm-10">
                        <input type="text" ng-model="model.Application.InspectionAddr" class="form-control" placeholder="检验地点" />
                    </div>
                </div>
                <div class="form-group">

                    <label class="col-sm-2 control-label">联系人 <span style="color: red;">*</span></label>

                    <div class="col-sm-10">
                        <input type="text" ng-model="model.Application.Inspector" class="form-control" placeholder="联系人" maxlength="100" />
                    </div>
                </div>
                <div class="form-group">

                    <label class="col-sm-2 control-label">联系人电话 <span style="color: red;">*</span></label>

                    <div class="col-sm-10">
                        <input type="text" ng-model="model.Application.InspectorTel" class="form-control" placeholder="联系人电话" />
                    </div>
                </div>
                <div class="form-group">

                    <label class="col-sm-2 control-label">发货港口 <span style="color: red;">*</span></label>

                    <div class="col-sm-10">
                        <select ajax-select ajax-url="ports" ng-model="model.Application.LoadingPort" ng-options="i.Code as i.CnName group by i.Country for i in model.LoadingPorts" class="form-control selectLoadingPort" style="width: 100%">
                            <option value="">&lt; - 请选择港口 - &gt;</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">

                    <label class="col-sm-2 control-label">目的港口 <span style="color: red;">*</span></label>

                    <div class="col-sm-10">
                        <select ajax-select ajax-url="ports" ng-model="model.Application.DestPort" ng-options="i.Code as i.CnName group by i.Country for i in model.DestPorts" class="form-control selectDestPorts" style="width: 100%">
                            <option value="">&lt; - 其他港口 - &gt;</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button class="btn btn-default" ng-click="submit()" ng-disabled="submitApp">
                            <span class="glyphicon glyphicon-ok-circle" aria-hidden="true"></span> 提交
                        </button>

                        <button ng-show="isNewApp" ng-disabled="isSaveingCache" class="btn btn-info" ng-click="SaveAppCache()">
                            <span class="glyphicon glyphicon-save" aria-hidden="true"></span> 暂存
                        </button>
                    </div>
                </div>
            </form>
        </div>

    </div>
    <!--login modal-->
    <div class="modal" role="dialog" aria-labelledby="gridSystemModalLabel" id="form-login">
        <div class="modal-dialog" role="document">
            <form name="appform" class="form-horizontal" method="POST">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h5 class="modal-title" id="gridSystemModalLabel">用户登录</h5>
                    </div>
                    <div class="modal-body">
                        <div class="form-group has-error" ng-show="!login.result">
                            <p class="col-sm-offset-2 col-sm-8 help-block">{{login.error}}</p>
                        </div>
                        <div class="form-group" ng-class="{ 'has-error' : (appform.email.$invalid && appform.email.$dirty) || user.email=='' }">

                            <label class="col-sm-2 control-label">邮箱 <span style="color: red;">*</span>: </label>

                            <div class="col-sm-8">
                                <input name="email" type="email" class="form-control" required ng-model="user.email" />
                                <small ng-show="appform.email.$invalid" class="help-block">请填写正确的邮箱</small>
                            </div>
                        </div>
                        <div class="form-group" ng-class="{ 'has-error' : (appform.password.$error.required && !appform.password.$pristine) || user.password=='' }">

                            <label class="col-sm-2 control-label">密码 <span style="color: red;">*</span>: </label>

                            <div class="col-sm-8">
                                <input name="password" type="password" class="form-control" required ng-model="user.password" />
                                <small ng-show="appform.password.$error.required" class="help-block">请输入您的密码</small>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" ng-click="submitLoginForm()"><span class="glyphicon glyphicon-ok-circle" aria-hidden="true"></span> 登录</button>
                    </div>
                </div><!-- /.modal-content -->
            </form>
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!--product list modal-->
    <div class="modal" role="dialog" data-backdrop="static" data-keyboard="false" id="form-product">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h5 class="modal-title">商品列表</h5>
                </div>
                <div class="modal-body giqci-modal-dialog">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#ciqProduct" data-toggle="tab">备案商品</a>
                        </li>
                        <li>
                            <a href="#custProduct" data-toggle="tab">非备案商品</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div role="tabpanel" class="form-horizontal tab-pane fade in active panel-body" id="ciqProduct">
                            <div class="form-group">
                                <table class="table table-striped table-layout-fixed">
                                    <colgroup>
                                        <col width='180' />
                                        <col />
                                        <col />
                                        <col width='100' />
                                        <col width='80' />
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th>
                                                <span style="color: green">商品备案号</span>
                                            </th>
                                            <th>名称(中文)</th>
                                            <th>名称(英文)</th>
                                            <th>规格</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="Product in merchantProductList">
                                            <td class="td-ellipsis" style="color: green" title="{{Product.CiqCode}}">{{Product.CiqCode}}</td>
                                            <td class="td-ellipsis" title="{{Product.Description}}">{{Product.Description}}</td>
                                            <td class="td-ellipsis" title="{{Product.DescriptionEn}}">{{Product.DescriptionEn}}</td>
                                            <td class="td-ellipsis" title="{{Product.Spec}}">{{Product.Spec}}</td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <button type="button" class="btn btn-danger btn-sm" ng-click="removeMerchantProductCiq(Product.CiqCode,$index)">删除</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div role="tabpanel" class="form-horizontal tab-pane fade panel-body" id="custProduct">
                            <div class="form-group">
                                <table class="table table-striped table-layout-fixed">
                                    <colgroup>
                                        <col width='180' />
                                        <col />
                                        <col />
                                        <col width='100' />
                                        <col width='120' />
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th>
                                                <span style="color: orangered">自定义标识</span>
                                            </th>
                                            <th>名称(中文)</th>
                                            <th>名称(英文)</th>
                                            <th>规格</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="Product in customProductList">
                                            <td class="td-ellipsis" style="color: orangered" title="{{Product.Code}}">{{Product.Code}}</td>
                                            <td class="td-ellipsis" title="{{Product.Description}}">{{Product.Description}}</td>
                                            <td class="td-ellipsis" title="{{Product.DescriptionEn}}">{{Product.DescriptionEn}}</td>
                                            <td class="td-ellipsis" title="{{Product.Spec}}">{{Product.Spec}}</td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <button ng-if="!Product.IsApproved" class="btn btn-primary btn-sm" ng-click="editMerchantProduct(Product)">编辑</button>
                                                    <button type="button" class="btn btn-danger btn-sm" ng-click="removeMerchantProductId(Product.Id,$index)">删除</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" ng-click="addGoodsProduct()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> 添加备案商品</button>
                    <button type="button" class="btn btn-default" ng-click="addCustomProduct()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> 添加非备案商品</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!--custom product add modal-->
    @Html.Partial("PopUp/EditProduct")
    <!--goods product add modal-->
    <div class="modal" role="dialog" data-backdrop="static" data-keyboard="false" id="form-add-goods-product">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h5 class="modal-title">添加备案商品</h5>
                </div>
                <div class="modal-body">
                    <div role="alert" class="alert alert-dismissible alert-{{alert.type}}" ng-repeat="alert in alerts">
                        <button aria-label="Close" data-dismiss="alert" ng-click="alert.close()" class="close" type="button"><span aria-hidden="true">×</span></button>
                        <span ng-bind="alert.msg"></span>
                    </div>
                    <form name="appform" class="form-horizontal" novalidate>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">商品备案号</label>
                            <div class="col-sm-8">
                                <div class="input-group">
                                    <input type="text" placeholder="请输入完整的商品备案号" ng-model="DialogProductCiqCode" class="form-control" />
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" ng-click="getDialogProductList()">
                                            <span class="glyphicon glyphicon-ok-circle" aria-hidden="true"></span> 搜索
                                        </button>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div ng-show="dialogProductList!=null">
                            <table class="table table-striped table-layout-fixed">
                                <colgroup>
                                    <col width='180' />
                                    <col />
                                    <col />
                                    <col width='80' />
                                    <col width='80' />
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th>商品备案号</th>
                                        <th>名称(中文)</th>
                                        <th>名称(英文)</th>
                                        <th>规格</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="td-ellipsis" title="{{dialogProductList.CiqCode}}">{{dialogProductList.CiqCode}}</td>
                                        <td class="td-ellipsis" title="{{dialogProductList.Description}}">{{dialogProductList.Description}}</td>
                                        <td class="td-ellipsis" title="{{dialogProductList.DescriptionEn}}">{{dialogProductList.DescriptionEn}}</td>
                                        <td class="td-ellipsis" title="{{dialogProductList.Spec}}">{{dialogProductList.Spec}}</td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <button type="button" class="btn btn-primary btn-sm" ng-click="addDialogGoodsProduct()">添加</button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" ng-click="showProductList()"><span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> 返回</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!--merchant list modal-->
    <div class="modal" role="dialog" data-backdrop="static" data-keyboard="false" id="form-merchant-list">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h5 class="modal-title">常用商户管理</h5>
                </div>
                <div class="modal-body giqci-modal-dialog">
                    <table class="table table-striped table-layout-fixed">
                        <colgroup>
                            <col />
                            <col />
                            <col width='140' />
                            <col width='120' />
                            <col width='140' />
                        </colgroup>
                        <thead>
                            <tr>
                                <th>全称</th>
                                <th>地址</th>
                                <th>联系人</th>
                                <th>联系电话</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="merchant in loadMerchantInfo">
                                <td class="td-ellipsis" title="{{merchant.UserName}}">{{merchant.UserName}}</td>
                                <td class="td-ellipsis" title="{{merchant.UserAddress}}">{{merchant.UserAddress}}</td>
                                <td class="td-ellipsis" title="{{merchant.UserContact}}">{{merchant.UserContact}}</td>
                                <td class="td-ellipsis" title="{{merchant.UserPhone}}">{{merchant.UserPhone}}</td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-primary btn-sm" ng-click="editMerchant(merchant.Id)">编辑</button>
                                        <button type="button" class="btn btn-danger btn-sm" ng-click="removeMerchant(merchant)">删除</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" ng-click="addMerchant()"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> 添加常用商户</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!-- merchant edit modal-->
    <div class="modal" role="dialog" data-backdrop="static" data-keyboard="false" id="merchant-add">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h5 class="modal-title merchant-add-title">添加常用商户信息</h5>
                </div>
                <div class="modal-body">
                    <div class="form-horizontal">
                        <div role="alert" class="alert alert-dismissible alert-{{alert.type}}" ng-repeat="alert in alerts">
                            <button aria-label="Close" data-dismiss="alert" ng-click="alert.close()" class="close" type="button"><span aria-hidden="true">×</span></button>
                            <span ng-bind="alert.msg"></span>
                        </div>
                        <div class="form-group">

                            <label class="col-sm-2 control-label">全称 <span style="color: red;">*</span></label>

                            <div class="col-sm-10">
                                <input type="text" maxlength="100" ng-model="dialogModelMerchant.UserName" class="form-control" />
                            </div>
                        </div>
                        <div class="form-group">

                            <label class="col-sm-2 control-label">地址 <span style="color: red;">*</span></label>

                            <div class="col-sm-10">
                                <input type="text" maxlength="400" ng-model="dialogModelMerchant.UserAddress" class="form-control" />
                            </div>
                        </div>
                        <div class="form-group">

                            <label class="col-sm-2 control-label">联系人 <span style="color: red;">*</span></label>

                            <div class="col-sm-10">
                                <input type="text" maxlength="100" ng-model="dialogModelMerchant.UserContact" class="form-control" />
                            </div>
                        </div>
                        <div class="form-group">

                            <label class="col-sm-2 control-label">联系电话 <span style="color: red;">*</span></label>

                            <div class="col-sm-10">
                                <input type="text" maxlength="100" ng-model="dialogModelMerchant.UserPhone" class="form-control" />
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <input type="hidden" ng-model="dialogModelMerchant.Id" />
                                <button class="btn btn-default" ng-click="submitAddMerchant()">
                                    <span class="glyphicon glyphicon-ok-circle" aria-hidden="true"></span> 提交
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</div>